Explanation of Formulas for Holonomic Wheel Setups

by Emmett Weisz on behalf of MTA Lionotics (FTC teams 5361 and 13475)

*** INTRO ***

This document explains how and why to use certain formulas to control a robot with holonomic wheels.
 A holonomic wheel setup is one that allows the robot to move in any direction, as opposed to
 this setup:
 |     |

 |     |, which cannot move side to side.

The robot is rigid, and therefore, it can only move in a combination of rigid motions: translation,
 rotation, and reflection. Although 13475's robot is bound to undergo a reflection during the
 competition, that would never happen to 5361. Therefore, the robot has three degrees of freedom:
 two dimensions of translation (x and y) and one dimension of rotation (z).

This means that in almost all cases, the motion of any three omni/mecanum wheels of a robot
 completely determines its motion. The robot could theoretically have only three omniwheels, like
 this:
     __

  \      /
  but that would be incredibly difficult to code and would not fit well on a square robot.

 The wheels could be set up like this |  --  |, but that configuration would not hold up the robot
 without additional wheels. However, there is a very similar holonomic setup with five omniwheels
 that is the simplest holonomic setup to code:

 |      |
    --
 |      |

 Team 5361 used this in 2019-2020.
 In this setup, the power to FL must equal BL, and FR = BR. Therefore, each of the three degrees of
 freedom can be controlled separately without any calculations. (for front/back and rotation ignore
 the center wheel and pretend the others are traction wheels, for strafing use only the center
 wheel). This avoids many of the problems of a symmetrical four-wheeled holonomic system, but the
 center wheel takes up extra space.

Therefore, we often use a symmetrical four-wheeled configuration. This setup is identical to mecanum
 wheels, and similar to a wheel configuration with one wheel at the center of each edge, but rotated
 45 degrees.However, this adds a complication: given the speeds of three of the wheels, there is
 only one possible speed the fourth omniwheel can move such that none of the wheels slip. For now,
 let's assume we don't want any of the wheels to slip.

*** MOVEMENT WITHOUT SLIPPING ***

The robot has three degrees of freedom: front/back movement, right/left movement, and rotation. To
do a combination of them at once, we calculate how to do each one separately, then add together the
results for each wheel. (To see why this works, imagine your point of view rotating with the robot,
but not moving. The robot now seems to be strafing without rotating. Now going back to a stationary
point of view, just add the values for a pure rotation. So we can add the values for a translation
and a rotation to get any movement. Same logic for adding vertical and horizontal motion.)

The robot is set up like this, where positive values go forward (up):
/FL  FR\

\BL  BR/

The power for each wheel is given by:
powerFL = forward + right + rotateClockwise
powerFR = forward - right - rotateClockwise
powerBR = forward + right - rotateClockwise
powerBL = forward - right + rotateClockwise

We can combine these equations to give:
powerFL + powerFR = powerBL + powerBR.
This means that for the robot not to slip, it has to have a consistent forward/backward speed.
There's nothing special about the forward direction. We can rearrange the above equation as
powerFL - powerBL = powerBR - powerFR.
This means it has a consistent right/left speed. Or,
powerFL - powerBR = powerBL - powerFR,
meaning it has a consistent rotational speed. Although these three equations seem to be saying
different things, they are all equivalent.

As you can see, this completely symmetrical holonomic setup is more complicated than the
five-wheeled one. The advantage is that it can have equally consistent movement horizontally and
vertically, and it takes up less space on the robot.

*** LIMITATIONS OF MOTION ***

For low speeds, the equation (in three version) above works fine. However, if we want the robot to
go quickly, we run into a problem. The power set to any motor must be between 1 and -1. If the
equation tells us to move a motor faster than that, we have two options: we can either slow all the
motors down proportionally, or we can just move that motor at the maximum speed and leave everything
else alone. This is a potentially important tradeoff between speed and consistency, since at least
one of the wheels must slip if the equation is not satisfied.

For example, what happens if we want to rotate the robot, pivoting about one of the wheels, say BR?
If we follow the equation for movement without slipping, the power for BR will be 0, FL will be set
to full power, and FR and BL will be set to half power. What will happen if we set FR and BL to full
power? Will it go slightly faster, twice as fast, or no faster at all? Will the slipping of the
wheels ruin the consistency? Or will the wheels have such good traction that they don't slip at all,
but push back against the motors?

*** LIMITATIONS OF THE GAMEPAD ***

When graphing the possible values of the gamepad, they form a regular octagon with minimum radius 1.
The center of the octagon is (0,0). Ignore rotation of the robot for the moment. The possible values
for forwardLeftPower and forwardRightPower form a square. Every point on the octagon must correspond
to a point on the square. So, either the octagon does not cover the square (meaning there will be
some velocities that cannot be reached with the gamepad, even though they are possible), or the
octagon is distorted to match the square. Choosing between these two options is another tradeoff
between speed and precision. However, if we don't want to be able to move as fast as possible, we
can make the "octagon" smaller than the square so that it fits inside, and the outer edges of the
square corresponding to faster speeds will not be covered.

*** ANOTHER APPROACH ***

